"use strict";angular.module("publicApp",["ngAnimate","ngCookies","ngSanitize","ngTouch","ui.router","ui.bootstrap","ui.sortable","ui.bootstrap.datepicker","flash","angularUtils.directives.uiBreadcrumbs"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("login"),a.state("login",{url:"/login",views:{"login@":{templateUrl:"views/login.html",controller:"LoginCtrl"}}}).state("logout",{url:"/logout",views:{"login@":{templateUrl:"views/logout.html",controller:"LogoutCtrl"}}}).state("home",{url:"/",data:{displayName:"Home"},views:{"main@":{templateUrl:"views/main.html",controller:"MainCtrl"}}}).state("blurbs",{url:"/blurbs",views:{"main@":{templateUrl:"views/blurbs/index.html",controller:"BlurbIndexCtrl"}},data:{displayName:"Blurbs"}}).state("blurbs.blurb",{url:"/:id",views:{"main@":{templateUrl:"views/blurbs/edit.html",controller:"BlurbEditCtrl"}},data:{displayName:"Blurb"}}).state("blurbs.create",{url:"/create",views:{"main@":{templateUrl:"views/blurbs/edit.html",controller:"BlurbEditCtrl"}},data:{displayName:"Create Blurb"},params:{id:"create"}}).state("assets",{url:"/assets",views:{"main@":{templateUrl:"views/assets/index.html",controller:"AssetIndexCtrl"}},data:{displayName:"Assets"},ncyBreadcrumb:{label:"Assets page"}}).state("assets.asset",{url:"/:id",views:{"main@":{templateUrl:"views/assets/edit.html",controller:"AssetEditCtrl"}},data:{displayName:"Asset"}}).state("assets.create",{url:"/create",views:{"main@":{templateUrl:"views/assets/edit.html",controller:"AssetEditCtrl"}},data:{displayName:"Create Asset"},params:{id:"create"}}).state("content-modules",{url:"/content-modules",views:{"main@":{templateUrl:"views/content-modules/index.html",controller:"ContentModuleIndexCtrl"}},data:{displayName:"Content Modules"},ncyBreadcrumb:{label:"Content Modules page"}}).state("content-modules.content-module",{url:"/:id",views:{"main@":{templateUrl:"views/content-modules/edit.html",controller:"ContentModuleEditCtrl"}},data:{displayName:"Content Module"}}).state("content-modules.create",{url:"/create",views:{"main@":{templateUrl:"views/content-modules/edit.html",controller:"ContentModuleEditCtrl"}},data:{displayName:"Create Content Module"},params:{id:"create"}}).state("lessons",{url:"/lessons",views:{"main@":{templateUrl:"views/lessons/index.html",controller:"LessonIndexCtrl"}},data:{displayName:"Lessons"}}).state("lessons.lesson",{url:"/:id",views:{"main@":{templateUrl:"views/lessons/edit.html",controller:"LessonEditCtrl"}},data:{displayName:"Lesson"}}).state("lessons.create",{url:"/create",views:{"main@":{templateUrl:"views/lessons/edit.html",controller:"LessonEditCtrl"}},data:{displayName:"Create Lesson"},params:{id:"create"}}).state("weeks",{url:"/weeks",views:{"main@":{templateUrl:"views/weeks/index.html",controller:"WeekIndexCtrl"}},data:{displayName:"Weeks"}}).state("weeks.week",{url:"/:id",views:{"main@":{templateUrl:"views/weeks/edit.html",controller:"WeekEditCtrl"}},data:{displayName:"Week"}}).state("weeks.create",{url:"/create",views:{"main@":{templateUrl:"views/weeks/edit.html",controller:"WeekEditCtrl"}},data:{displayName:"Create Week"},params:{id:"create"}}).state("programs",{url:"/programs",views:{"main@":{templateUrl:"views/programs/index.html",controller:"ProgramIndexCtrl"}},data:{displayName:"Programs"}}).state("programs.program",{url:"/:id",views:{"main@":{templateUrl:"views/programs/edit.html",controller:"ProgramEditCtrl"}},data:{displayName:"Program"}}).state("programs.create",{url:"/create",views:{"main@":{templateUrl:"views/programs/edit.html",controller:"ProgramEditCtrl"}},data:{displayName:"Create Program"},params:{id:"create"}})}]).config(["$logProvider",function(a){a.debugEnabled(!0)}]).run(["$rootScope","ParseService","$state","Flash",function(a,b,c,d){a.$on("$stateChangeStart",function(b,d,e,f,g){a.loading=!0;var h="login"===d.name,i=Parse.User.current();if(i)h&&(b.preventDefault(),c.go("home"));else{if(h)return;b.preventDefault(),c.go("login")}}),a.$on("$stateChangeSuccess",function(){var b=Parse.User.current();b?(a.isLoggedIn=!0,a.currentUser=b):a.isLoggedIn=!1,d.dismiss(1)})}]),angular.module("publicApp").filter("capitalize",function(){return function(a){return a?a.charAt(0).toUpperCase()+a.substr(1).toLowerCase():""}}),angular.module("publicApp").controller("MainCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],console.log("hi from MainCtrl")}),angular.module("publicApp").controller("LoginCtrl",["$scope","$state","$rootScope",function(a,b,c){console.log("hi from LoginCtrl"),a.submit=function(){console.log("Username",a.username,"Password",a.password),Parse.User.logIn(a.username,a.password,{success:function(a){console.log("success",a),c.isLoggedIn=!1,b.go("home")},error:function(a,b){console.log("error",b)}})}}]),angular.module("publicApp").controller("LogoutCtrl",["$scope","$rootScope","$state",function(a,b,c){console.log("hi from LogoutCtrl"),Parse.User.logOut(),b.isLoggedIn=!1,c.go("login")}]),angular.module("publicApp").controller("BlurbIndexCtrl",["$scope","Blurb",function(a,b){a.loading=!0,a.filteringResults=!1,a.myState="blurbs",a.content="contentIdentifier";var c={success:function(b){a.loading=!1,a.$apply(function(){a.resources=b})},error:function(a){console.log("error getting resources")}};b.findParseInstances(c),a.search=function(){a.loading=!0,a.filteringResults=!0,b.findParseInstancesMatching({key:"contentIdentifier",substring:a.resourceQuery},c)}}]).controller("BlurbEditCtrl",["$scope","Blurb","$stateParams",function(a,b,c){"create"===c.id?a.resource=new b:(console.log("stateparams id",c.id),b.getParseInstance(c.id,{success:function(b){a.$apply(function(){a.resource=b})},error:function(a){console.log("error")}}))}]),angular.module("publicApp").controller("AssetIndexCtrl",["$scope","Asset","$state",function(a,b,c){a.loading=!0,a.filteringResults=!1,a.$state=c,a.myState="assets",a.content="contentIdentifier"}]).controller("AssetEditCtrl",["$scope","$stateParams","Asset","Flash","$state",function(a,b,c,d,e){console.log("Getting asset",b.id),a.files={},a.uploadedFileUrls={},"create"===b.id?a.resource=new c:c.getParseInstance(b.id,{success:function(b){a.$apply(function(){a.resource=b,a.uploadedFileUrls={},c.supportedLanguages.forEach(function(c){b.get(c)&&(a.uploadedFileUrls[c]=b.get(c).url())})}),console.log(b)},error:function(a){console.log("error")}})}]),angular.module("publicApp").controller("LessonIndexCtrl",["$scope","Lesson",function(a,b){a.loading=!0,a.filteringResults=!1;var c={success:function(b){a.loading=!1,a.$apply(function(){a.resources=b})},error:function(a){console.log("error getting resources")}};b.findParseInstances(c),a.search=function(){a.loading=!0,a.filteringResults=!0,b.findParseInstancesMatching({key:"title",substring:a.resourceQuery},c)}}]).controller("LessonEditCtrl",["$scope","Lesson","$stateParams",function(a,b,c){"create"===c.id?a.resource=new b:(console.log("stateparams id",c.id),b.getParseInstance(c.id).then(function(b){a.$apply(function(){a.resource=b,console.log(b)})}))}]),angular.module("publicApp").controller("ContentModuleIndexCtrl",["$scope","ContentModule",function(a,b){a.loading=!0,a.filteringResults=!1,a.typeOptions=b.typeOptions,a.contentModuleType=a.typeOptions[0],a.myState="content-modules";var c={success:function(b){a.$apply(function(){a.loading=!1,a.resources=b}),console.log("setting resources",a.resources)},error:function(b){console.log("error getting resources"),a.loading=!1}};b.findParseInstances(c),a.search=function(){a.loading=!0,a.filteringResults=!0,b.findParseInstancesMatching({key:"contentIdentifier",substring:a.resourceQuery},c)}}]).controller("ContentModuleEditCtrl",["$scope","$stateParams","ContentModule","Flash","$state","Blurb","Asset","$timeout",function(a,b,c,d,e,f,g,h){a.files={},a.typeOptions=Object.keys(c.typeOptions),a.blurbs={},a.assets={},a.$watch("resource.type",function(b,c){a.resource&&i()}),"create"===b.id?(a.resource=new c,a.resource.type="tip",a.resource.set("content",{}),a.resource.content={}):c.getParseInstance(b.id).then(function(b){a.$apply(function(){a.resource=b}),b.content&&Object.keys(b.content).forEach(function(c){a.resource.type=c;var d=b.content[c].id||b.content[c].objectId;console.log(d),f.getParseInstance(d).then(function(b){console.log(b),a.$apply()}),g.getParseInstance(b.content[c].id).then(function(b){a.$apply(function(){})})})});var i=function(){console.log(a.resource.type),"response"!==a.resource.type?(a.blurbOptions=c.typeOptions[a.resource.type].blurbOptions,a.assetOptions=c.typeOptions[a.resource.type].assetOptions):a.resource.type="tod"}}]),angular.module("publicApp").controller("WeekIndexCtrl",["$scope","Week",function(a,b){a.loading=!0,a.filteringResults=!1}]).controller("WeekEditCtrl",["$scope","Week","$stateParams",function(a,b,c){"create"===c.id?a.resource=new b:(console.log("stateparams id",c.id),b.getParseInstance(c.id).then(function(b){console.log(b),a.$apply(function(){a.resource=b})}))}]),angular.module("publicApp").controller("ProgramIndexCtrl",["$scope","Program",function(a,b){a.loading=!0,a.filteringResults=!1;var c={success:function(b){a.loading=!1,a.$apply(function(){a.resources=b})},error:function(a){console.log("error getting resources")}};b.findParseInstances(c),a.search=function(){a.loading=!0,a.filteringResults=!0,b.findParseInstancesMatching({key:"title",substring:a.resourceQuery},c)}}]).controller("ProgramEditCtrl",["$scope","Program","$stateParams",function(a,b,c){"create"===c.id?a.resource=new b:(console.log("stateparams id",c.id),b.getParseInstance(c.id).then(function(b){a.$apply(function(){a.resource=b})}))}]),angular.module("publicApp").service("ParseService",["$rootScope",function(a){return Parse.initialize("sekritAppId","sekritClientKey"),Parse.serverURL="http://parse-onazure.azurewebsites.net/parse",console.log("initialized parse"),{find:function(a,b){var c=Parse.Object.extend(a),d=new Parse.Query(c);d.find({success:function(a){b(null,a)},error:function(a){b(a,null),console.log(a)}})},get:function(a,b,c){var d=Parse.Object.extend(a),e=new Parse.Query(d);e.get(b,{success:function(a){c(null,a)},error:function(a){c(a,null),console.log(a)}})}}}]),angular.module("publicApp").factory("Asset",["ParseObjectBridge",function(a){var b=a.instantiate("Asset",["contentIdentifier","en_us","en_gb"]);return b.supportedLanguages=["en_us","en_gb"],b}]),angular.module("publicApp").factory("Blurb",["ParseObjectBridge",function(a){var b=a.instantiate("Blurb",["contentIdentifier","en_us","en_gb"]);return b.supportedLanguages=["en_us","en_gb"],b}]),angular.module("publicApp").factory("Lesson",["ParseObjectBridge",function(a){var b=a.instantiate("Lesson",["title"]);return b.getParseInstance=function(a,b){var c=new Parse.Query(this);return c.include("contentModules"),c.get(a,b).then(function(a){return a.contentModules=a.get("contentModules"),a})},b}]),angular.module("publicApp").factory("ContentModule",["ParseObjectBridge",function(a){var b=a.instantiate("ContentModule",["type","contentIdentifier","contentModules"]);return b.supportedLanguages=["en_us","en_gb"],b.typeOptions={tip:{blurbOptions:["tip"]},quote:{blurbOptions:["quote","author"],assetOptions:["avatar"]},tod:{blurbOptions:["question","response"],assetOptions:["background"]},text:{blurbOptions:["text"]}},b.getParseInstance=function(a,b){var c=new Parse.Query(this);return c.get(a,b).then(function(a){return a.content=a.get("content"),a})},b}]),angular.module("publicApp").factory("Week",["ParseObjectBridge",function(a){var b=a.instantiate("Week",["title"]);return b.getParseInstance=function(a,b){var c=new Parse.Query(this);return c.include("lessons"),c.get(a,b).then(function(a){return a.lessons=a.get("lessons"),a})},b}]),angular.module("publicApp").factory("Program",["ParseObjectBridge",function(a){var b=a.instantiate("Program",["title"]);return b.getParseInstance=function(a,b){var c=new Parse.Query(this);return c.include("weeks"),c.get(a,b).then(function(a){return a.weeks=a.get("weeks"),a.startDate=a.get("startDate"),a})},b}]),angular.module("publicApp").factory("DeleteItem",function(){return{markedForDeletion:function(a,b,c){var d=a.get(c).filter(function(a){return a.id!==b.id?a:void 0});return d}}}),angular.module("publicApp").factory("DeleteItemFromParent",function(){return{markedForDeletion:function(a,b,c,d,e){d.getParseInstance(a.id).then(function(a){var f=e.markedForDeletion(a,b,c);console.log("array now: ",f),a.set(c,f),d.save(a)})}}}),angular.module("publicApp").factory("ParseObjectBridge",["ParseService",function(a){return{instantiate:function(a,b){var c=Parse.Object.extend(a);return b.forEach(function(a){c.prototype.__defineGetter__(a,function(){return this.get(a)}),c.prototype.__defineSetter__(a,function(b){return this.set(a,b)})}),c.findParseInstances=function(a){var b=new Parse.Query(this);return b.addDescending("createdAt").find(a)},c.findParseInstancesMatching=function(a,b){var c=new Parse.Query(this);return c.contains(a.key,a.substring).addDescending("createdAt").find(b)},c.findParseInstancesEqualTo=function(a,b){var c=new Parse.Query(this);return c.equalTo(a.key,a.substring).addDescending("createdAt").find(b)},c.getParseInstance=function(a,b){var c=new Parse.Query(this);return c.get(a,b)},c.save=function(a){a.save().then(function(a){console.log("saved :",a)},function(a){console.log("didn't save: ",a)})},c}}}]),angular.module("publicApp").directive("blurbEditForm",["Blurb","$state","Flash",function(a,b,c){return{replace:!0,scope:{resource:"=blurb"},templateUrl:"views/blurbs/edit_directive.html",link:function(d,e){d.submit=function(){var a=!d.resource.id;console.log(d.resource.id),d.resource.save({success:function(d){c.create("success","Blurb Saved","custom-class"),a&&b.go(".",{id:d.id})},error:function(a){c.create("error","Blurb Failed to Save","custom-class")}})},d["delete"]=function(){d.resource.destroy({success:function(a){console.log("deleted",a),c.create("success","Blurb Deleted"),b.go("^")},error:function(a){console.log("error deleting",result)}})},d.supportedLanguages=a.supportedLanguages}}}]),angular.module("publicApp").directive("contentModuleEditForm",["ContentModule","Blurb","Asset","$state","Flash",function(a,b,c,d,e){return{replace:!0,scope:{resource:"=contentModule",files:"=",typeOptions:"=",blurbs:"=",assest:"=",blurbOptions:"=",assetOptions:"="},templateUrl:"views/content-modules/edit_directive.html",link:function(a,f){a.submit=function(){var b=!a.resource.id;a.resource.set("content",a.resource.content);var c;if(!a.resource.contentIdentifier){switch(a.resource.type){default:c=a.resource.type}c&&(a.resource.contentIdentifier="cm-"+a.resource.content[c].contentIdentifier)}a.resource.save({success:function(a){e.create("success","Content Module Saved","custom-class"),b&&d.go(".",{id:a.id})},error:function(a){e.create("error","Content Module Failed to Save","custom-class")}})},a.getBlurbContentIdentifiers=function(a){return b.findParseInstancesMatching({key:"contentIdentifier",substring:a}).then(function(a){return a.map(function(a){return a})})},a.getAssetContentIdentifiers=function(a){return c.findParseInstancesMatching({key:"contentIdentifier",substring:a}).then(function(a){return a.map(function(a){return a})})},a.selectedItems={},a.addItem=function(d,e){var f=void 0;"blurb"===d?f=b:"asset"===d&&(f=c),f.findParseInstancesEqualTo({key:"contentIdentifier",substring:a.selectedItems[e]}).then(function(b){if(console.log(b),b&&b.length){var c=b[0];if(console.log(e),"quote"===a.resource.type){for(var d in a.resource.content)"quote"!==d&&"author"!==d&&"avatar"!==d&&delete a.resource.content[d];a.resource.content[e]=c,console.log(a.resource.content)}else if("tod"===a.resource.type){for(var d in a.resource.content)"question"!==d&&"response"!==d&&"background"!==d&&delete a.resource.content[d];a.resource.content[e]=c,console.log(a.resource.content)}else a.resource.content={},a.resource.content[e]=c,console.log(a.resource.content);a.submit()}})},a.deleteItem=function(b){a.resource.content=DeleteItem.markedForDeletion($scope.resource,b,"contentModules"),a.submit()},a["delete"]=function(){a.resource.destroy({success:function(a){console.log("deleted",a),e.create("success","Content Module Deleted"),d.go("^")},error:function(a){console.log("error deleting",result)}})},a.supportedLanguages=b.supportedLanguages}}}]),angular.module("publicApp").directive("assetEditForm",["Asset","$state","Flash",function(a,b,c){return{replace:!0,scope:{resource:"=asset",loading:"=",filteringResults:"=",files:"=",uploadedFileUrls:"="},templateUrl:"views/assets/edit_directive.html",link:function(d,e,f,g){d.section="assets.asset({id: resource.id})",d.submit=function(){var a=!d.resource.id;console.log(d.resource.id),d.resource.save({success:function(d){c.create("success","Asset Saved","custom-class"),a&&b.go(".",{id:d.id})},error:function(a){c.create("error","Asset Failed to Save","custom-class")}})},d.uploadFile=function(a,b,c){console.log("language: ",a),console.log("should get called: ",c),console.log("files",b),d.files[a]=b[0]},d.submitUpload=function(a){console.log(d.files);var b=d.files[a];console.log("uploading",d.files,"for lang",a);var c=new Parse.File(b.name,b);c.save().then(function(){d.resource.set(a,c),d.resource.save().then(function(){console.log("attached file",a),d.$apply(function(){d.uploadedFileUrls[a]=c.url()})})},function(a){})},d["delete"]=function(){d.resource.destroy({success:function(a){console.log("deleted",a),c.create("success","Asset Deleted"),b.go("^")},error:function(a){console.log("error deleting",result)}})},d.supportedLanguages=a.supportedLanguages}}}]),angular.module("publicApp").directive("lessonEditForm",["Lesson","Week","$state","Flash","DeleteItemFromParent","ContentModule","DeleteItem",function(a,b,c,d,e,f,g){return{replace:!0,scope:{resource:"=lesson",loading:"=",filteringResults:"="},templateUrl:"views/program-week-lesson/edit_directive.html",link:function(a,h,i){a.childType="Content Module",a.getChildType="contentModules",a.type="Lesson",a.getType="lessons",a.findType="contentIdentifier",a.routeSpecifier="content-modules",a.submit=function(){var b=!a.resource.id;a.resource.set("contentModules",a.resource.contentModules),a.resource.save().then(function(a){d.create("success","Lesson Saved","custom-class"),b&&c.go(".",{id:a.id})},function(a){d.create("error","Lesson Failed to Save","custom-class"),console.log("error saving",a)})},a["delete"]=function(){var f=a.resource.get("week");if(f){a.resource.get("week").get("lessons"),e.markedForDeletion(f,a.resource,"lessons",b,g)}a.resource.destroy({success:function(a){console.log("deleted",a),d.create("success","Lesson Deleted"),c.go("^")},error:function(a){console.log("error deleting",result)}})},a.getChildContent=function(a){return f.findParseInstancesMatching({key:"contentIdentifier",substring:a}).then(function(a){return a})},a.selectedItem=void 0,a.addItem=function(){a.resource.contentModules||(a.resource.contentModules=[]),console.log("selectedItem",a.selectedItem);var b=!1;return a.resource.contentModules.forEach(function(c){c.contentIdentifier==a.selectedItem&&(b=!0)}),b?void d.create("error",'Content Module "'+a.selectedItem+'" already included'):void f.findParseInstancesEqualTo({key:"contentIdentifier",substring:a.selectedItem}).then(function(b){if(b&&b.length){var c=b[0];a.resource.add("contentModules",c),a.$apply(function(){a.selectedItem="",a.resource.contentModules=a.resource.get("contentModules"),a.submit()})}})},a.deleteItem=function(b){a.resource.contentModules=g.markedForDeletion(a.resource,b,"contentModules"),a.submit()}}}}]),angular.module("publicApp").directive("weekEditForm",["Week","$state","Program","Flash","DeleteItemFromParent","Lesson","DeleteItem",function(a,b,c,d,e,f,g){return{replace:!0,scope:{resource:"=week",loading:"=",filteringResults:"="},templateUrl:"views/program-week-lesson/edit_directive.html",link:function(a,h,i){a.childType="Lesson",a.getChildType="lessons",a.type="Week",a.getType="weeks",a.findType="title",a.routeSpecifier="lessons",a.submit=function(){var c=!a.resource.id;a.resource.set("lessons",a.resource.lessons),console.log("week",a.resource),a.resource.save().then(function(a){console.log(a),d.create("success","Lesson Saved","custom-class"),c&&b.go(".",{id:a.id})},function(a){d.create("error","Lesson Failed to Save","custom-class"),console.log("error saving",a)})},a["delete"]=function(){var f=a.resource.get("program");if(f){a.resource.get("program").get("weeks"),e.markedForDeletion(f,a.resource,"weeks",c,g)}a.resource.destroy({success:function(a){console.log("deleted",a),d.create("success","Week Deleted"),b.go("^")},error:function(a){console.log("error deleting",result)}})},a.getChildContent=function(a){return f.findParseInstancesMatching({key:"title",substring:a}).then(function(a){return console.log(a),a})},a.selectedItem=void 0,a.addItem=function(){a.resource.lessons||(a.resource.lessons=[]),console.log("selectedItem",a.selectedItem);var b=!1;return a.resource.lessons.forEach(function(c){c.title==a.selectedItem&&(b=!0)}),b?void d.create("error",'Week "'+a.selectedItem+'" already included',"custom-class"):void f.findParseInstancesEqualTo({key:"title",substring:a.selectedItem}).then(function(b){if(console.log(b),b&&b.length){var c=b[0];c.set("week",a.resource),c.save().then(function(){a.resource.add("lessons",c),a.$apply(function(){a.selectedItem="",a.resource.lessons=a.resource.get("lessons"),a.submit()})})}})},a.deleteItem=function(b){a.resource.lessons=g.markedForDeletion(a.resource,b,"lessons"),a.submit()}}}}]),angular.module("publicApp").directive("programEditForm",["Week","$state","Flash","DeleteItemFromParent","Lesson","DeleteItem",function(a,b,c,d,e,f){return{replace:!0,scope:{resource:"=program",loading:"=",filteringResults:"="},templateUrl:"views/program-week-lesson/edit_directive.html",link:function(d,e,g){d.childType="Week",d.getChildType="weeks",d.type="Program",d.getType="programs",d.findType="title",d.routeSpecifier="weeks",d.submit=function(){var a=!d.resource.id;console.log("Program",d.resource),d.resource.set("weeks",d.resource.weeks);var e=(new Date,new Date(d.resource.startDate));"Invalid Date"===e.toString()&&(e=new Date),d.resource.set("startDate",e),d.resource.save().then(function(d){c.create("success","Week Saved","custom-class"),a&&b.go(".",{id:d.id})},function(a){c.create("error","Week Failed to Save","custom-class"),console.log("error saving",a)})},d["delete"]=function(){d.resource.destroy({success:function(a){console.log("deleted",a),c.create("success","Program Deleted"),b.go("^")},error:function(a){console.log("error deleting",result)}})},d.getChildContent=function(b){return a.findParseInstancesMatching({key:"title",substring:b}).then(function(a){return console.log(a),a})},d.selectedItem=void 0,d.addItem=function(){d.resource.weeks||(d.resource.weeks=[]),console.log("selectedItem",d.selectedItem);var b=!1;return d.resource.weeks.forEach(function(a){a.title==d.selectedItem&&(b=!0)}),b?void c.create("error",'Week "'+d.selectedItem+'" already included'):void a.findParseInstancesEqualTo({key:"title",substring:d.selectedItem}).then(function(a){if(console.log(a),a&&a.length){var b=a[0];b.set("program",d.resource),b.save().then(function(){d.resource.add("weeks",b),d.$apply(function(){d.selectedItem="",d.resource.weeks=d.resource.get("weeks"),d.submit()})})}})},d.deleteItem=function(a){d.resource.weeks=f.markedForDeletion(d.resource,a,"weeks"),d.submit()}}}}]),angular.module("publicApp").directive("assetIndexForm",["Asset","Flash",function(a,b){return{replace:!0,scope:{resource:"=asset",loading:"=",filteringResults:"=",myState:"=",contentIdentifier:"@"},templateUrl:"views/assets-blurbs-contentmodules/index_directive.html",link:function(b,c,d){b.type="File",b.name="Asset";var e={success:function(a){b.$apply(function(){b.loading=!1,b.resources=a}),console.log("setting resources",b.resources)},error:function(a){console.log("error getting resources"),b.loading=!1}};a.findParseInstances(e),b.search=function(){b.loading=!0,b.filteringResults=!0,a.findParseInstancesMatching({key:"contentIdentifier",substring:$scope.resourceQuery},e)}}}}]),angular.module("publicApp").directive("blurbIndexForm",["Blurb","Flash",function(a,b){return{replace:!0,scope:{resource:"=blurb",loading:"=",filteringResults:"=",myState:"=",contentIdentifier:"@"},templateUrl:"views/assets-blurbs-contentmodules/index_directive.html",link:function(b,c,d){b.type="English Copy",b.name="Blurb";var e={success:function(a){b.$apply(function(){b.loading=!1,b.resources=a}),console.log("setting resources",b.resources)},error:function(a){console.log("error getting resources"),b.loading=!1}};a.findParseInstances(e),b.search=function(){b.loading=!0,b.filteringResults=!0,a.findParseInstancesMatching({key:"contentIdentifier",substring:$scope.resourceQuery},e)}}}}]),angular.module("publicApp").directive("contentModuleIndexForm",["ContentModule","Flash",function(a,b){return{replace:!0,scope:{resource:"=contentModule",loading:"=",filteringResults:"=",myState:"=",contentIdentifier:"@"},templateUrl:"views/assets-blurbs-contentmodules/index_directive.html",link:function(b,c,d){b.type="Content",b.name="Content Module",b.typeOptions=a.typeOptions,b.contentModuleType=b.typeOptions[0];var e={success:function(a){b.$apply(function(){b.loading=!1,b.resources=a}),console.log("setting resources",b.resources)},error:function(a){console.log("error getting resources"),b.loading=!1}};a.findParseInstances(e),b.search=function(){b.loading=!0,b.filteringResults=!0,a.findParseInstancesMatching({key:"contentIdentifier",substring:$scope.resourceQuery},e)}}}}]),angular.module("publicApp").directive("lessonIndexForm",["Lesson","Flash",function(a,b){return{replace:!0,scope:{loading:"=",filteringResults:"="},templateUrl:"views/program-week-lesson/index_directive.html",link:function(b,c,d){b.myState="lessons",b.type="lesson";var e={success:function(a){b.loading=!1,b.$apply(function(){b.resources=a})},error:function(a){console.log("error getting resources")}};a.findParseInstances(e),b.search=function(){b.loading=!0,b.filteringResults=!0,a.findParseInstancesMatching({key:"title",substring:b.resourceQuery},e)}}}}]),angular.module("publicApp").directive("weekIndexForm",["Week","Flash",function(a,b){return{replace:!0,scope:{loading:"=",filteringResults:"="},templateUrl:"views/program-week-lesson/index_directive.html",link:function(b,c,d){b.myState="weeks",b.type="week";var e={success:function(a){b.loading=!1,b.$apply(function(){b.resources=a})},error:function(a){console.log("error getting resources")}};a.findParseInstances(e),b.search=function(){b.loading=!0,b.filteringResults=!0,a.findParseInstancesMatching({key:"title",substring:b.resourceQuery},e)}}}}]),angular.module("publicApp").directive("programIndexForm",["Program","Flash",function(a,b){return{replace:!0,scope:{loading:"=",filteringResults:"="},templateUrl:"views/program-week-lesson/index_directive.html",link:function(b,c,d){b.myState="programs",b.type="program";var e={success:function(a){b.loading=!1,b.$apply(function(){b.resources=a})},error:function(a){console.log("error getting resources")}};a.findParseInstances(e),b.search=function(){b.loading=!0,b.filteringResults=!0,a.findParseInstancesMatching({key:"title",substring:b.resourceQuery},e)}}}}]),angular.module("publicApp").run(["$templateCache",function(a){a.put("views/assets-blurbs-contentmodules/index_directive.html",'<div> <div class="container-fluid" ng-show="filteringResults || resources.length"> <form ng-submit="search()"> <input type="text" ng-model="resourceQuery" placeholder="Search" class="form-control"> </form> <table class="table table-hover"> <thead> <tr style="font-weight: bold"> <td>Content Identifier</td> <td>{{ type }}</td> <td class="actions">Actions</td> </tr> </thead> <tbody ng-hide="loading"> <tr ng-repeat="resource in resources"> <td ng-if="resource.get(\'contentIdentifier\')">{{ resource.get(\'contentIdentifier\') }}</td> <td ng-if="resource.className === \'Asset\'">{{ resource.get(\'en_us\').url() }}</td> <td ng-if="resource.className === \'ContentModule\'">{{ resource.type }}</td> <td ng-if="resource.className === \'Blurb\'">{{ resource.en_us }}</td> <td class="actions"> <a ng-href="#/{{ myState }}/{{ resource.id }}" class="glyphicon glyphicon-pencil" data-toggle="tooltip" data-placement="top" title="Edit"></a> </td> </tr> </tbody> </table> <!-- <div ng-hide=\'!loading\' style="margin-left: auto; margin-right: auto; display: block" class="spinner-loader"></div> --> <!-- <pagination total-items="totalItems" items-per-page="perPage" ng-model="currentPage" ng-change="pageChanged()" ng-hide="totalItems <= perPage"></pagination> --> </div> <div class="container-fluid" ng-show="resources.length <= 0 && !filteringResults"> <div class="well" style="display:block; margin-left: auto; margin-right: auto; text-align: center"> <h3>You have no {{ name }}s yet, get started by creating one</h3> <br> <a ui-sref=".create" type="button" class="btn btn-success">Create {{ name }}</a> </div> </div> </div>'),a.put("views/assets/edit.html",'<!-- <a ui-sref=\'users.user.notificationTokens({userId: user.id})\' class=\'pull-right\'>NotificationTokens</a> --><!-- <br/> --><!-- <a ui-sref=\'users.user.notify({userId: user.id})\' ng-show="user.notificationTokens.length > 0" class=\'pull-right\'>Send Notification</a> --> <div ng-if="resource"> <div asset-edit-form asset="resource" files="files" uploaded-file-urls="uploadedFileUrls" loading="loading"></div> </div> <div ng-if="!resource">Loading...</div>'),a.put("views/assets/edit_directive.html",'<div> <div class="container-fluid"> <div class="row well"> <form novalidate ng-submit="submit()"> <div class="col-md-12"> <div class="form-group"> <label for="contentIdentifier">Content Identifier</label> <input type="text" class="form-control" placeholder="Enter Content Identifier" ng-model="resource.contentIdentifier" required> </div> <input type="submit" name="submit" value="Save" class="btn btn-success pull-right"> </div> </form> </div> <div class="row well" ng-repeat="lang in supportedLanguages"> <form novalidate ng-submit="submitUpload(lang)"> <div class="col-md-6"> <div class="form-group"> <label for="file">{{lang}} File</label> <input type="file" name="{{lang}}" onchange="angular.element(this).scope().uploadFile(angular.element(this).scope().lang, files)"> </div> <input type="submit" name="upload" value="Upload" class="btn btn-success"> </div> <div class="col-md-6 container"> <img style="width: 100px" ng-src="{{uploadedFileUrls[lang]}}"> </div> </form> </div> </div> <hr> <div class="container-fluid" ng-show="resource.id"> <h4>Danger Zone</h4> <br> <button ng-click="delete()" type="button" class="btn btn-danger">Delete Asset</button> </div> </div>'),a.put("views/assets/index.html",'<asset-index-form asset="resource" loading="loading" my-state="myState" content="contentIdentidifer" filtering-results="filterResults"> </asset-index-form>'),a.put("views/blurbs/edit.html","<!-- <a ui-sref='users.user.notificationTokens({userId: user.id})' class='pull-right'>NotificationTokens</a> --><!-- <br/> --><!-- <a ui-sref='users.user.notify({userId: user.id})' ng-show=\"user.notificationTokens.length > 0\" class='pull-right'>Send Notification</a> --> <div ng-if=\"resource\"> <div blurb-edit-form blurb=\"resource\"></div> </div> <div ng-if=\"!resource\">Loading...</div>"),a.put("views/blurbs/edit_directive.html",'<div> <form novalidate ng-submit="submit()"> <div class="row"> <div class="col-md-1"> <label for="contentIdentifier">Content Identifier</label> </div> <div class="col-md-11"> <input type="text" class="form-control" placeholder="Enter Content Identifier" ng-model="resource.contentIdentifier" required> <i style="color: lightgrey">Format: purpose-synopsis (with no spaces). Ex: quote-breath-deeply</i> </div> </div> <br><br> <div class="row"> <!-- <div class=\'col-md-1\'>\n              <label for="type">Blurbs</label>\n            </div> --> <div class="col-md-12"> <div class="panel panel-default"> <!-- Default panel contents --> <div class="panel-heading"><h4>Localized Content</h4></div> <!-- Table --> <table class="table table-hover"> <tbody> <tr ng-repeat="lang in supportedLanguages"> <td style="width: 10%; text-align:right">{{ lang }}</td> <td> <textarea rows="3" style="width: 100%" class="form-control" ng-model="resource[lang]"></textarea> </td> </tr> </tbody> </table> </div> </div> </div> <!-- <div class=\'row\' ng-repeat=\'lang in supportedLanguages\'>\n          <div class=\'col-md-1\'>\n            <label for="{{lang}}">{{lang}}</label>\n          </div>\n          <div class=\'col-md-11\'>\n            <textarea rows="3" style="width: 100%" class="form-control" ng-model=\'resource[lang]\'></textarea>\n          </div>\n        </div>\n           --> <input type="submit" name="submit" value="Save" class="btn btn-success pull-right"> </form> <hr> <div class="container-fluid" ng-show="resource.id"> <h4>Danger Zone</h4> <br> <button ng-click="delete()" type="button" class="btn btn-danger">Delete Blurb</button> </div> </div>'),
a.put("views/blurbs/index.html",'<blurb-index-form blurb="resource" loading="loading" my-state="myState" content="contentIdentidifer" filtering-results="filterResults"> </blurb-index-form>'),a.put("views/content-modules/edit.html",'<!-- <a ui-sref=\'users.user.notificationTokens({userId: user.id})\' class=\'pull-right\'>NotificationTokens</a> --><!-- <br/> --><!-- <a ui-sref=\'users.user.notify({userId: user.id})\' ng-show="user.notificationTokens.length > 0" class=\'pull-right\'>Send Notification</a> --> <div ng-if="resource"> <div content-module-edit-form content-module="resource" files="files" blurbs="blurbs" assets="assets" type-options="typeOptions" blurb-options="blurbOptions" asset-options="assetOptions"></div> </div> <div ng-if="!resource">Loading...</div>'),a.put("views/content-modules/edit_directive.html",'<div> <form novalidate ng-submit="submit()"> <div class="row"> <div class="col-md-1"> <label for="type">Content Identifier</label> </div> <div class="col-md-5"> <input type="text" class="form-control" ng-model="resource.contentIdentifier" required> </div> </div> <br> <div class="row"> <div class="col-md-1"> <label for="type">Type</label> </div> <div class="col-md-5"> <select class="form-control" ng-model="resource.type"> <option ng-repeat="typeOption in typeOptions">{{typeOption}}</option> </select> <!-- <input type="text" class="form-control" placeholder="Enter Type" ng-model="resource.type" required /> --> </div> </div> <br> <div class="row" ng-if="blurbOptions.length"> <!-- <div class=\'col-md-1\'>\n				<label for="type">Blurbs</label>\n			</div> --> <div class="col-md-12"> <div class="panel panel-default"> <!-- Default panel contents --> <div class="panel-heading"><h4>Blurbs</h4></div> <!-- Table --> <table class="table table-hover"> <tbody> <tr ng-repeat="blurbOption in blurbOptions"> <td style="width: 20%">{{ blurbOption }}</td> <td> <p ng-if="resource.content[blurbOption]"> <a ng-if="!resource.content[blurbOption].id" target="_blank" ui-sref="blurbs.blurb({id: resource.content[blurbOption].objectId })">{{ resource.content[blurbOption].contentIdentifier }}</a> <a ng-if="resource.content[blurbOption].id" target="_blank" ui-sref="blurbs.blurb({id: resource.content[blurbOption].id })">{{ resource.content[blurbOption].contentIdentifier }}</a> : <i>"{{ resource.content[blurbOption].en_us }}"</i> </p> <div class="input-group"> <input type="text" ng-model="selectedItems[blurbOption]" placeholder="blurb content identifier" uib-typeahead="item.contentIdentifier for item in getBlurbContentIdentifiers($viewValue)" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-click="addItem(&quot;blurb&quot;, blurbOption)">Update</button> </span> </div> </td> </tr> </tbody> </table> </div> </div> </div> <div class="row" ng-if="assetOptions.length"> <!-- <div class=\'col-md-1\'>\n				<label for="type">Blurbs</label>\n			</div> --> <div class="col-md-12"> <div class="panel panel-default"> <!-- Default panel contents --> <div class="panel-heading"><h4>Assets</h4></div> <!-- Table --> <table class="table table-hover"> <tbody> <tr ng-repeat="assetOption in assetOptions"> <td style="width: 20%">{{ assetOption }}</td> <td> <a ng-if="resource.content[assetOption].id" target="_blank" ui-sref="assets.asset({id: resource.content[assetOption].id })">{{ resource.content[assetOption].contentIdentifier }}</a> : <p> <img ng-src="{{ resource.content[assetOption].en_us.url() }}"> </p> <div class="input-group"> <input type="text" ng-model="selectedItems[assetOption]" placeholder="asset content identifier" uib-typeahead="item.contentIdentifier for item in getAssetContentIdentifiers($viewValue)" class="form-control"> <span class="input-group-btn"> <button class="btn btn-default" type="button" ng-click="addItem(&quot;asset&quot;, assetOption)">Update</button> </span> </div> </td> </tr> </tbody> </table> </div> </div> </div> <input type="submit" name="submit" value="Save" class="btn btn-success pull-right"> </form> <br> <div class="container-fluid" ng-show="resource.id"> <h4>Danger Zone</h4> <br> <button ng-click="delete()" type="button" class="btn btn-danger">Delete Content Module</button> </div> </div>'),a.put("views/content-modules/index.html",'<content-module-index-form content-module="resource" loading="loading" my-state="myState" content="contentIdentidifer" filtering-results="filterResults"> </content-module-index-form>'),a.put("views/lessons/edit.html",'<div ng-if="resource"> <div lesson-edit-form lesson="resource" loading="loading" filtering-results="filteringResults"></div> </div> <div ng-if="!resource">Loading...</div>'),a.put("views/lessons/edit_directive.html",'<div> <form novalidate ng-submit="submit()"> <div class="row"> <div class="col-md-1"> <label for="title">Title</label> </div> <div class="col-md-11"> <input type="text" class="form-control" placeholder="Enter Title" ng-model="resource.title" required> </div> </div> <br> <div class="row"> <div class="col-md-1"> <label for="type">{{ childType }}</label> </div> <div class="col-md-11"> <ul ui-sortable ng-model="resource.contentModules" class="list-group" style="list-style: none"> <li ng-repeat="contentModule in resource.contentModules" class="list-group-item"> <span class="glyphicon glyphicon glyphicon-align-justify" aria-hidden="true"></span> <a ui-sref="content-modules.content-module({id: contentModule.id})">{{ contentModule.contentIdentifier }}</a> <a ng-click="deleteItem(contentModule)" href class="glyphicon glyphicon-trash pull-right" data-toggle="tooltip" data-placement="top" title="Delete"> </a></li> <li> <div class="input-group"> <input type="text" ng-model="selectedItem" placeholder="{{ childType }} Identifier" uib-typeahead="item.contentIdentifier for item in getChildContent($viewValue)" class="form-control"> <span class="input-group-btn"> <button ng-click="addItem()" type="button" class="btn btn-default">Add</button> </span> </div> </li> </ul> </div> </div> <input type="submit" name="submit" value="Save" class="btn btn-success pull-right"> </form> <br> <div class="container-fluid" ng-show="resource.id"> <h4>Danger Zone</h4> <br> <button ng-click="delete()" type="button" class="btn btn-danger">Delete {{ type }}</button> </div> </div>'),a.put("views/lessons/index.html",'<lesson-index-form loading="loading" filtering-results="filteringResults"></lesson-index-form>'),a.put("views/login.html",'<div class="container well"> <form novalidate ng-submit="submit()"> <input type="text" class="form-control" placeholder="Enter Username" ng-model="username" required> <input type="password" class="form-control" placeholder="Password" ng-model="password" required> <input type="submit" name="submit" value="Login" class="btn btn-success pull-right"> </form> </div>'),a.put("views/logout.html","Logout"),a.put("views/main.html",""),a.put("views/program-week-lesson/edit_directive.html",'<div> <form novalidate ng-submit="submit()"> <div class="row"> <div class="col-md-1"> <label for="title">Title</label> </div> <div class="col-md-11"> <input type="text" class="form-control" placeholder="Enter Title" ng-model="resource.title" required> </div> </div> <br> <div class="row"> <div class="col-md-1"> <label for="type">{{ childType }}</label> </div> <div class="col-md-11"> <ul ui-sortable ng-model="resource[getChildType]" class="list-group" style="list-style: none"> <li ng-repeat="item in resource[getChildType]" class="list-group-item"> <span class="glyphicon glyphicon glyphicon-align-justify" aria-hidden="true"></span> <a ng-href="#/{{ routeSpecifier }}/{{ item.id }}">{{ item[findType] }}</a> <a ng-click="deleteItem(item)" href class="glyphicon glyphicon-trash pull-right" data-toggle="tooltip" data-placement="top" title="Delete"></a> </li> <li> <div class="input-group"> <input type="text" ng-model="selectedItem" placeholder="{{ childType }} Identifier" uib-typeahead="item[findType] for item in getChildContent($viewValue)" class="form-control"> <span class="input-group-btn"> <button ng-click="addItem()" type="button" class="btn btn-default">Add</button> </span> </div> </li> </ul> </div> </div> <div ng-if="resource.className === \'Program\'" class="row"> <div class="col-md-1"> <label>Start Date</label> </div> <div class="col-md-11"> <div style="display:inline-block; min-height:290px"> <uib-datepicker ng-model="resource.startDate" min-date="minDate" show-weeks="true" class="well well-sm"></uib-datepicker> </div> <!-- <p class="input-group">\n              <input type="text" class="form-control" uib-datepicker-popup ng-model="resource.startDate" is-open="popup1.opened" min-date="minDate" max-date="maxDate" ng-required="true" close-text="Close" alt-input-formats="altInputFormats" />\n              <span class="input-group-btn">\n                <button type="button" class="btn btn-default" ng-click="open1()"><i class="glyphicon glyphicon-calendar"></i></button>\n              </span>\n            </p> --> <!-- <date-picker ng-model="resource.startDate"></date-picker> --> <!-- <input ng-disabled="true" value="{{resource.startDate | date: \'shortDate\'}}" /> --> </div> </div> <input type="submit" name="submit" value="Save" class="btn btn-success pull-right"> </form> <br> <div class="container-fluid" ng-show="resource.id"> <h4>Danger Zone</h4> <br> <button ng-click="delete()" type="button" class="btn btn-danger">Delete {{ type }}</button> </div> </div>'),a.put("views/program-week-lesson/index_directive.html",'<div> <div class="container-fluid" ng-show="filteringResults || resources.length"> <form ng-submit="search()"> <input type="text" ng-model="resourceQuery" placeholder="Search" class="form-control"> </form> <table class="table table-hover"> <thead> <tr style="font-weight: bold"> <td>Title</td> <td class="actions">Actions</td> </tr> </thead> <tbody> <tr ng-repeat="resource in resources"> <td>{{ resource.title }}</td> <td class="actions"> <a ng-href="#/{{ myState }}/{{ resource.id }}" class="glyphicon glyphicon-pencil" data-toggle="tooltip" data-placement="top" title="Edit"></a> <!-- <a href ng-confirm-message="Are you sure?" ng-confirm-click=\'deleteResource(resource.id)\' ng-confirm-condition=true\n							class=\'glyphicon glyphicon-trash\' data-toggle=\'tooltip\' data-placement=\'top\' title=\'Delete\'>\n						</a> --> </td> </tr> </tbody> </table> <!-- <pagination total-items="totalItems" items-per-page="perPage" ng-model="currentPage" ng-change="pageChanged()" ng-hide="totalItems <= perPage"></pagination> --> </div> <div class="container-fluid" ng-show="resources.length <= 0 && !filteringResults"> <div class="well" style="display:block; margin-left: auto; margin-right: auto; text-align: center"> <h3>You have no {{ type }} yet, get started by creating one</h3> <br> <a ui-sref=".create" type="button" class="btn btn-success">Create a {{ type | capitalize }}</a> </div> </div> </div>'),a.put("views/programs/edit.html",'<div ng-if="resource"> <div program-edit-form program="resource" loading="loading" filtering-results="filteringResults"></div> </div> <div ng-if="!resource">Loading...</div>'),a.put("views/programs/index.html",'<program-index-form loading="loading" filtering-results="filteringResults"></program-index-form>'),a.put("views/weeks/edit.html",'<div ng-if="resource"> <div week-edit-form week="resource" loading="loading" filtering-results="filteringResults"></div> </div> <div ng-if="!resource">Loading...</div>'),a.put("views/weeks/index.html",'<week-index-form loading="loading" filtering-results="filteringResults"></week-index-form>')}]);